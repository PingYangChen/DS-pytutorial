---
title: "é—œè¯å¼åˆ†æ Association Rules"
format: html
lang: zh-TW
---


## é—œè¯å¼åˆ†æç°¡ä»‹

é—œè¯å¼åˆ†æï¼ˆAssociation Rule Miningï¼‰æ˜¯ä¸€ç¨®è³‡æ–™æŒ–æ˜æŠ€è¡“ï¼Œæ—¨åœ¨å¾å¤§å‹è³‡æ–™é›†ä¸­æ‰¾å‡ºé …ç›®ä¹‹é–“çš„æœ‰è¶£æ¨¡å¼æˆ–é—œè¯è¦å‰‡ã€‚å®ƒä¸»è¦æ‡‰ç”¨æ–¼äº¤æ˜“æ•¸æ“šä¸­ï¼Œä¾‹å¦‚å¸‚å ´ç±ƒåˆ†æï¼Œå¹«åŠ©é›¶å”®å•†è­˜åˆ¥å“ªäº›ç”¢å“å¸¸ä¸€èµ·è³¼è²·ï¼Œé€²è€Œå„ªåŒ–éŠ·å”®ç­–ç•¥ã€‚

é—œè¯å¼è¦å‰‡çš„åŸºæœ¬æ¦‚å¿µ
é …ç›®é›†ï¼šä¸€çµ„é …ç›®ï¼Œé€šå¸¸æ˜¯ä¸€å€‹äº¤æ˜“ä¸­çš„è³¼è²·é …ç›®ã€‚
ä¾‹å¦‚ï¼š{éºµåŒ…, ç‰›å¥¶}
æ”¯æŒåº¦ (Support)ï¼šé …ç›®é›†åœ¨æ‰€æœ‰äº¤æ˜“ä¸­å‡ºç¾çš„é »ç‡ã€‚
å…¬å¼ï¼š
æ”¯æŒåº¦
(
ğ´
)
=
(
åŒ…å«é …ç›®é›†
ğ´
çš„äº¤æ˜“æ•¸
)
(
ç¸½äº¤æ˜“æ•¸
)
æ”¯æŒåº¦(A)= 
(ç¸½äº¤æ˜“æ•¸)
(åŒ…å«é …ç›®é›†Açš„äº¤æ˜“æ•¸)
â€‹
 
ä¿¡è³´åº¦ (Confidence)ï¼šç•¶è³¼è²·é …ç›®Xæ™‚ï¼Œè³¼è²·é …ç›®Yçš„æ¦‚ç‡ã€‚
å…¬å¼ï¼š
ä¿¡è³´åº¦
(
ğ‘‹
â‡’
ğ‘Œ
)
=
æ”¯æŒåº¦
(
ğ‘‹
âˆª
ğ‘Œ
)
æ”¯æŒåº¦
(
ğ‘‹
)
ä¿¡è³´åº¦(Xâ‡’Y)= 
æ”¯æŒåº¦(X)
æ”¯æŒåº¦(XâˆªY)
â€‹
 
æå‡åº¦ (Lift)ï¼šåœ¨è€ƒæ…®é …ç›®Yçš„å—æ­¡è¿ç¨‹åº¦ä¸‹ï¼Œé …ç›®Xå’ŒYä¸€èµ·è³¼è²·çš„å¯èƒ½æ€§ã€‚
å…¬å¼ï¼š
æå‡åº¦
(
ğ‘‹
â‡’
ğ‘Œ
)
=
ä¿¡è³´åº¦
(
ğ‘‹
â‡’
ğ‘Œ
)
æ”¯æŒåº¦
(
ğ‘Œ
)
æå‡åº¦(Xâ‡’Y)= 
æ”¯æŒåº¦(Y)
ä¿¡è³´åº¦(Xâ‡’Y)
â€‹
 
Aprioriæ¼”ç®—æ³•
Aprioriæ¼”ç®—æ³•æ˜¯é—œè¯å¼è¦å‰‡æŒ–æ˜ä¸­æœ€å¸¸è¦‹çš„æ–¹æ³•ä¹‹ä¸€ï¼Œåˆ©ç”¨ã€Œè‡ªåº•å‘ä¸Šã€çš„æ–¹æ³•ä¾†è­˜åˆ¥é »ç¹é …ç›®é›†ã€‚é€™å€‹ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œè‹¥æŸå€‹é …ç›®é›†æ˜¯ä¸é »ç¹çš„ï¼Œå‰‡å®ƒçš„æ‰€æœ‰è¶…é›†ä¹Ÿå¿…ç„¶æ˜¯ä¸é »ç¹çš„ã€‚Aprioriæ¼”ç®—æ³•åˆ†ç‚ºå…©å€‹ä¸»è¦æ­¥é©Ÿï¼š

é »ç¹é …ç›®é›†çš„å°‹æ‰¾ï¼šæ‰¾å‡ºæ”¯æŒåº¦è¶…éé–¾å€¼çš„é …ç›®é›†ã€‚
ç”¢ç”Ÿé—œè¯è¦å‰‡ï¼šåˆ©ç”¨é »ç¹é …ç›®é›†ä¾†ç”¢ç”Ÿè¦å‰‡ï¼Œä¸¦è¨ˆç®—ä¿¡è³´åº¦å’Œæå‡åº¦ã€‚
é€™é¡åˆ†æå»£æ³›æ‡‰ç”¨æ–¼é›¶å”®æ¥­çš„å¸‚å ´ç±ƒåˆ†æï¼Œå¹«åŠ©ä¼æ¥­æ›´å¥½åœ°ç†è§£å®¢æˆ¶è³¼ç‰©è¡Œç‚ºï¼Œå¾è€Œå„ªåŒ–éŠ·å”®ç­–ç•¥å’Œç”¢å“æ“ºæ”¾ã€‚

```{python}
import pandas as pd
from apyori import apriori
```

```{python}
market_data = [['T-Shirt','Pants','Jeans','Jersy','Socks','Basketball','Bottle','Shorts'],
 ['T-Shirt','Jeans'],
 ['Jersy','Basketball','Socks','Bottle'],
 ['Jeans','Pants','Bottle'],
 ['Shorts','Basketball'],
 ['Shorts','Jersy'],
 ['T-Shirt'],
 ['Basketball','Jersy'],
 ]

```
```{python}
## Data è‡ªè¡Œå®šç¾©æ•¸æ“š
market_data = [['T-Shirt','Pants','Jeans','Jersy','Socks','Basketball','Bottle','Shorts'],
 ['T-Shirt','Jeans'],
 ['Jersy','Basketball','Socks','Bottle'],
 ['Jeans','Pants','Bottle'],
 ['Shorts','Basketball'],
 ['Shorts','Jersy'],
 ['T-Shirt'],
 ['Basketball','Jersy'],
 ]
association_rules = apriori(market_data, min_support=0.2, min_confidence=0.2, min_lift=2, max_length=2)
association_results = list(association_rules)
print(association_results )
for product in association_results:
 #print(product) # ex. RelationRecord(items=frozenset({'Basketball', 'Socks'}), support=0.25, ordered_statistics=[OrderedStatistic(items_base=frozenset({'Basketball'}), items_add=frozenset({'Socks'}), confidence=0.5, lift=2.0), OrderedStatistic(items_base=frozenset({'Socks'}), items_add=frozenset({'Basketball'}), confidence=1.0, lift=2.0)])
 pair = product[0] 
 ##print(pair) ## ex. frozenset({'Basketball', 'Socks'})
 products = [x for x in pair]
 print(products) # ex. ['Basketball', 'Socks']
 print("Rule: " + products[0] + " â†’" + products[1])
 print("Support: " + str(product[1]))
 print("Lift: " + str(product[2][0][3]))
 print("==================================")
```

```{python}
from mlxtend.frequent_patterns import apriori
from mlxtend.frequent_patterns import association_rules
```

```{python}
market_data = {
 'Transaction ID': [1,2,3,4,5,6,7,8],
 'Items':[['T-Shirt','Pants','Jeans','Jersy','Socks','Basketball','Bottle','Shorts'],
 ['T-Shirt','Jeans'],
 ['Jersy','Basketball','Socks','Bottle'],
 ['Jeans','Pants','Bottle'],
 ['Shorts','Basketball'],
 ['Shorts','Jersy'],
 ['T-Shirt'],
 ['Basketball','Jersy'],
 ]}
```


```{python}
## è½‰æˆDataFrame
data = pd.DataFrame(market_data)
## è®“DataFrame èƒ½å‘ˆç¾çš„å¯¬åº¦å¤§ä¸€é»
pd.options.display.max_colwidth = 100
## è½‰æˆæ•¸å€¼ç·¨ç¢¼ï¼Œç›®å‰éƒ½æ˜¯å­—ä¸²çš„çµ„åˆ
data_id = data.drop('Items', 1)
data_items = data.Items.str.join(',')
## è½‰æˆæ•¸å€¼
data_items = data_items.str.get_dummies(',')
## æ¥ä¸ŠTransaction ID
data = data_id.join(data_items)
## è¨ˆç®—æ”¯æŒåº¦ Support
Support_items = apriori(data[['T-Shirt','Pants','Jeans','Jersy','Socks','Basketball','Bottle','Shorts']], min_support=0.20, use_colnames = True)
## è¨ˆç®—é—œè¯è¦å‰‡ Association Rule
Association_Rules = association_rules(Support_items, metric = 'lift', min_threshold=1)

Association_Rules
```